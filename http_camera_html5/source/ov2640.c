/***********************************************

标题: ov2640.c
作者: 秋阳电子
网址：http://qiuyangdz.taobao.com
日期: 2013/03/15
版本：v1.0
功能: ov2640初始化及相关单片机引脚初始化
说明：
*************************************************/
#include "stm32f10x.h"
#include "iic.h"
#include "ov2640.h"
#include "stm32f10x_exti.h"
#include "misc.h"
#include <stdio.h>

/* JPG, 0x176x144 */
const u8 ov2640_176x144_jpeg[][2]=
{
  0xff, 0x01,
  0x11, 0x02,	
  0x12, 0x40,
  0x17, 0x11,
  0x18, 0x43,
  0x19, 0x00,
  0x1a, 0x4b,
  0x32, 0x09,
  0x4f, 0xca,
  0x50, 0xa8,
  0x5a, 0x23,
  0x6d, 0x00,
  0x39, 0x12,
  0x35, 0xda,
  0x22, 0x1a,
  0x37, 0xc3,
  0x23, 0x00,
  0x34, 0xc0,
  0x36, 0x1a,
  0x06, 0x88,
  0x07, 0xc0,
  0x0d, 0x87,
  0x0e, 0x41,
  0x4c, 0x00,

  0xff, 0x00,
  0xe0, 0x04,
  0xc0, 0x64,
  0xc1, 0x4b,
  0x86, 0x35,
  0x50, 0x92,
  0x51, 0xc8,
  0x52, 0x96,
  0x53, 0x00,
  0x54, 0x00,
  0x55, 0x00,
  0x57, 0x00,
  0x5a, 0x2c,
  0x5b, 0x24,
  0x5c, 0x00,
  0xe0, 0x00,  
};

/* JPG, 0x320x240 */
const u8 ov2640_320x240_jpeg[][2]=
{
   0xff,  0x01,
   0x11,  0x82,	//CLK
   0x12,  0x00, // Bit[6:4]: Resolution selection//0x02为彩条
   0x17,  0x11, // HREFST[10:3]
   0x18,  0x75, // HREFEND[10:3]
   0x32,  0x09, // Bit[5:3]: HREFEND[2:0]; Bit[2:0]: HREFST[2:0]
   0x19,  0x01, // VSTRT[9:2]
   0x1a,  0x97, // VEND[9:2]
   0x03,  0x0f, // Bit[3:2]: VEND[1:0]; Bit[1:0]: VSTRT[1:0]
   0x37,  0x40,
   0x4f,  0xbb,
   0x50,  0x9c,
   0x5a,  0x57,
   0x6d,  0x80,
   0x3d,  0x34,
   0x39,  0x02,
   0x35,  0x88,
   0x22,  0x0a,
   0x37,  0x40,
   0x34,  0xa0,
   0x06,  0x02,
   0x0d,  0xb7,
   0x0e,  0x01,

   0xff,  0x00,
   0xe0,  0x04,
   0xc0,  0xc8,
   0xc1,  0x96,
   0x86,  0x3d,
   0x50,  0x92,
   0x51,  0x90,
   0x52,  0x2c,
   0x53,  0x00,
   0x54,  0x00,
   0x55,  0x88,
   0x57,  0x00,
   0x5a,  0x50,
   0x5b,  0x3c,
   0x5c,  0x00,
   0xd3,  0x7f,//0x7f,
   0xe0,  0x00,
};

/* JPG, 0x352x288 */
const u8 ov2640_352x288_jpeg[][2]=
{
   0xff,  0x01,
   0x11,  0x04,	
   0x12,  0x00, 
   0x17,  0x11, 
   0x18,  0x75, 
   0x32,  0x36, 
   0x19,  0x01, 
   0x1a,  0x97, 
   0x03,  0x0f, 
   0x37,  0x40,
   0x4f,  0xbb,
   0x50,  0x9c,
   0x5a,  0x57,
   0x6d,  0x80,
   0x3d,  0x34,
   0x39,  0x02,
   0x35,  0x88,
   0x22,  0x0a,
   0x37,  0x40,
   0x34,  0xa0,
   0x06,  0x02,
   0x0d,  0xb7,
   0x0e,  0x01,
	  
   0xff,  0x00,
   0xe0,  0x04,
   0xc0,  0xc8,
   0xc1,  0x96,
   0x86,  0x35,
   0x50,  0x92,
   0x51,  0x90,
   0x52,  0x2c,
   0x53,  0x00,
   0x54,  0x00,
   0x55,  0x88,
   0x57,  0x00,
   0x5a,  0x58,
   0x5b,  0x48,
   0x5c,  0x00,
   0xd3,  0x04,//0x7f,
   0xe0,  0x00,
};

/* JPG, 0x640x480 */
const u8 ov2640_640x480_jpeg[][2]=
{
   0xff,  0x01,
   0x11,  0x82,//0x06	
   0x12,  0x00, 
   0x17,  0x11, 
   0x18,  0x75, 
   0x32,  0x09, //0x36:uxvga
   0x19,  0x01, 
   0x1a,  0x97,
   0x03,  0x0f, 
   0x37,  0x40,
   0x4f,  0xbb,
   0x50,  0x9c,
   0x5a,  0x57,
   0x6d,  0x80,
   0x3d,  0x34,
   0x39,  0x02,
   0x35,  0x88,
   0x22,  0x0a,
   0x37,  0x40,
   0x34,  0xa0,
   0x06,  0x02,
   0x0d,  0xb7,
   0x0e,  0x01,

   0xff,  0x00,
   0xe0,  0x04,
   0xc0,  0xc8,
   0xc1,  0x96,
   0x86,  0x3d,
   0x50,  0x89,
   0x51,  0x90,
   0x52,  0x2c,
   0x53,  0x00,
   0x54,  0x00,
   0x55,  0x88,
   0x57,  0x00,
   0x5a,  0xa0,
   0x5b,  0x78,
   0x5c,  0x00,
   0xd3,  0x7f,//0x7f,
   0xe0,  0x00,
};

/* JPG, 0x800x600 */
const u8 ov2640_800x600_jpeg[][2]=
{
   0xff,  0x01,
   0x11,  0x82,
   0x12,  0x00, 
   0x17,  0x11, 
   0x18,  0x75, 
   0x32,  0x36, 
   0x19,  0x01, 
   0x1a,  0x97, 
   0x03,  0x0f, 
   0x37,  0x40,
   0x4f,  0xbb,
   0x50,  0x9c,
   0x5a,  0x57,
   0x6d,  0x80,
   0x3d,  0x34,
   0x39,  0x02,
   0x35,  0x88,
   0x22,  0x0a,
   0x37,  0x40,
   0x34,  0xa0,
   0x06,  0x02,
   0x0d,  0xb7,
   0x0e,  0x01,

   0xff,  0x00,
   0xe0,  0x04,
   0xc0,  0xc8,
   0xc1,  0x96,
   0x86,  0x35,
   0x50,  0x89,
   0x51,  0x90,
   0x52,  0x2c,
   0x53,  0x00,
   0x54,  0x00,
   0x55,  0x88,
   0x57,  0x00,
   0x5a,  0xc8,
   0x5b,  0x96,
   0x5c,  0x00,
   0xd3,  0x7f,
   0xe0,  0x00,
};

/* JPG, 0x1024x768 */
const u8 ov2640_1024x768_jpeg[][2]=
{
   0xff,  0x01,
   0x11,  0x0a,	
   0x12,  0x00, 
   0x17,  0x11, 
   0x18,  0x75, 
   0x32,  0x36, 
   0x19,  0x01, 
   0x1a,  0x97, 
   0x03,  0x0f, 
   0x37,  0x40,
   0x4f,  0xbb,
   0x50,  0x9c,
   0x5a,  0x57,
   0x6d,  0x80,
   0x3d,  0x34,
   0x39,  0x02,
   0x35,  0x88,
   0x22,  0x0a,
   0x37,  0x40,
   0x34,  0xa0,
   0x06,  0x02,
   0x0d,  0xb7,
   0x0e,  0x01,

   0xff,  0x00,
   0xc0,  0xC8,
   0xc1,  0x96,
   0x8c,  0x00,
   0x86,  0x3D,
   0x50,  0x00,
   0x51,  0x90,
   0x52,  0x2C,
   0x53,  0x00,
   0x54,  0x00,
   0x55,  0x88,
   0x5a,  0x00,
   0x5b,  0xC0,
   0x5c,  0x01,
   0xd3,  0x7f,
}; 

const u8 ov2640_jpeg[][2]=
{
  0xe0, 0x14,
  0xe1, 0x77,
  0xe5, 0x1f,
  0xd7, 0x03,
  0xda, 0x10,
  0xe0, 0x00,
  0xFF, 0x01,
  0x04, 0x08,
};

const u8 ov2640_yuv422[][2]= 
{
  0xFF, 0x00,
  0x05, 0x00,
  0xDA, 0x10,
  0xD7, 0x03,
  0xDF, 0x00,
  0x33, 0x80,
  0x3C, 0x40,
  0xe1, 0x77,
  0x00, 0x00,
};

const u8 ov2640_jpeg_init[][2]=
{
  0xff, 0x00,
  0x2c, 0xff,
  0x2e, 0xdf,
  0xff, 0x01,
  0x3c, 0x32,
  0x11, 0x00,
  0x09, 0x02,
  0x04, 0x28,
  0x13, 0xe5,
  0x14, 0x48,
  0x2c, 0x0c,
  0x33, 0x78,
  0x3a, 0x33,
  0x3b, 0xfB,
  0x3e, 0x00,
  0x43, 0x11,
  0x16, 0x10,
  0x39, 0x92,
  0x35, 0xda,
  0x22, 0x1a,
  0x37, 0xc3,
  0x23, 0x00,
  0x34, 0xc0,
  0x36, 0x1a,
  0x06, 0x88,
  0x07, 0xc0,
  0x0d, 0x87,
  0x0e, 0x41,
  0x4c, 0x00,
  0x48, 0x00,
  0x5B, 0x00,
  0x42, 0x03,
  0x4a, 0x81,
  0x21, 0x99,
  0x24, 0x40,
  0x25, 0x38,
  0x26, 0x82,
  0x5c, 0x00,
  0x63, 0x00,
  0x61, 0x70,
  0x62, 0x80,
  0x7c, 0x05,
  0x20, 0x80,
  0x28, 0x30,
  0x6c, 0x00,
  0x6d, 0x80,
  0x6e, 0x00,
  0x70, 0x02,
  0x71, 0x94,
  0x73, 0xc1,
  0x12, 0x40,//0x40
  0x17, 0x11,
  0x18, 0x43,
  0x19, 0x00,
  0x1a, 0x4b,
  0x32, 0x09,
  0x37, 0xc0,
  0x4f, 0x60,
  0x50, 0xa8,
  0x6d, 0x00,
  0x3d, 0x38,
  0x46, 0x3f,
  0x4f, 0x60,
  0x0c, 0x3c,
  0xff, 0x00,
  0xe5, 0x7f,
  0xf9, 0xc0,
  0x41, 0x24,
  0xe0, 0x14,
  0x76, 0xff,
  0x33, 0xa0,
  0x42, 0x20,
  0x43, 0x18,
  0x4c, 0x00,
  0x87, 0xd5,
  0x88, 0x3f,
  0xd7, 0x03,
  0xd9, 0x10,
  0xd3, 0x82,
  0xc8, 0x08,
  0xc9, 0x80,
  0x7c, 0x00,
  0x7d, 0x00,
  0x7c, 0x03,
  0x7d, 0x48,
  0x7d, 0x48,
  0x7c, 0x08,
  0x7d, 0x20,
  0x7d, 0x10,
  0x7d, 0x0e,
  0x90, 0x00,
  0x91, 0x0e,
  0x91, 0x1a,
  0x91, 0x31,
  0x91, 0x5a,
  0x91, 0x69,
  0x91, 0x75,
  0x91, 0x7e,
  0x91, 0x88,
  0x91, 0x8f,
  0x91, 0x96,
  0x91, 0xa3,
  0x91, 0xaf,
  0x91, 0xc4,
  0x91, 0xd7,
  0x91, 0xe8,
  0x91, 0x20,
  0x92, 0x00,
  0x93, 0x06,
  0x93, 0xe3,
  0x93, 0x05,
  0x93, 0x05,
  0x93, 0x00,
  0x93, 0x04,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x96, 0x00,
  0x97, 0x08,
  0x97, 0x19,
  0x97, 0x02,
  0x97, 0x0c,
  0x97, 0x24,
  0x97, 0x30,
  0x97, 0x28,
  0x97, 0x26,
  0x97, 0x02,
  0x97, 0x98,
  0x97, 0x80,
  0x97, 0x00,
  0x97, 0x00,
  0xc3, 0xed,
  0xa4, 0x00,
  0xa8, 0x00,
  0xc5, 0x11,
  0xc6, 0x51,
  0xbf, 0x80,
  0xc7, 0x10,
  0xb6, 0x66,
  0xb8, 0xA5,
  0xb7, 0x64,
  0xb9, 0x7C,
  0xb3, 0xaf,
  0xb4, 0x97,
  0xb5, 0xFF,
  0xb0, 0xC5,
  0xb1, 0x94,
  0xb2, 0x0f,
  0xc4, 0x5c,
  0xc0, 0x64,
  0xc1, 0x4B,
  0x8c, 0x00,
  0x86, 0x3D,
  0x50, 0x00,
  0x51, 0xC8,
  0x52, 0x96,
  0x53, 0x00,
  0x54, 0x00,
  0x55, 0x00,
  0x5a, 0xC8,
  0x5b, 0x96,
  0x5c, 0x00,
  0xd3, 0x7f,
  0xc3, 0xed,
  0x7f, 0x00,
  0xda, 0x00,
  0xe5, 0x1f,
  0xe1, 0x67,
  0xe0, 0x00,
  0xdd, 0x7f,
  0x05, 0x00,

  0x12, 0x40,//0x40
  0xd3, 0x7f,
  0xc0, 0x16,
  0xC1, 0x12,
  0x8c, 0x00,
  0x86, 0x3d,
  0x50, 0x00,
  0x51, 0x2C,
  0x52, 0x24,
  0x53, 0x00,
  0x54, 0x00,
  0x55, 0x00,
  0x5A, 0x2c,
  0x5b, 0x24,
  0x5c, 0x00,
};
/*************************************************

名称：void o2640_capture_gpio_init(void)
功能：ov2640相关控制引脚初始化
输入参数：无
输出参数：无
返回值：  无
**************************************************/
void o2640_capture_gpio_init(void)
{
  GPIO_InitTypeDef  GPIO_InitStructure; 
  EXTI_InitTypeDef EXTI_InitStructure;
  NVIC_InitTypeDef NVIC_InitStructure;

  NVIC_PriorityGroupConfig(NVIC_PriorityGroup_1); //

  RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOC,ENABLE);
//0=PCLK, 1=HREF
  GPIO_InitStructure.GPIO_Pin =GPIO_Pin_0 | GPIO_Pin_1 |  GPIO_Pin_8 | GPIO_Pin_9 | GPIO_Pin_10 | GPIO_Pin_11 | GPIO_Pin_12 | GPIO_Pin_13 | GPIO_Pin_14 | GPIO_Pin_15;//| GPIO_Pin_14| GPIO_Pin_15;  //15=HREF
  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPU;

  GPIO_Init(GPIOC, &GPIO_InitStructure);



  RCC_APB2PeriphClockCmd(RCC_APB2Periph_AFIO, ENABLE);

  /* 将中断IO引脚映射到中断源(EXTI Line) */
  GPIO_EXTILineConfig(GPIO_PortSourceGPIOC, GPIO_PinSource0);  //0=PCLK

  /* 配置中断线 */
  EXTI_InitStructure.EXTI_Line = EXTI_Line0 ;

  /* 配置为外中断 */
  EXTI_InitStructure.EXTI_Mode = EXTI_Mode_Interrupt;

  /* 设置触发沿 */
  EXTI_InitStructure.EXTI_Trigger = EXTI_Trigger_Rising;
   
  /* 使能中断 */
  EXTI_InitStructure.EXTI_LineCmd = ENABLE;
  EXTI_Init(&EXTI_InitStructure);

  /* 配置NVIC */
  NVIC_InitStructure.NVIC_IRQChannel = EXTI0_IRQn;	//引脚对应的中断IRQn
	
  NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0;	//抢占优先级
  NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;  //响应优先级
	
  NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;  //使能IRQn
	
  NVIC_Init(&NVIC_InitStructure);
}
/*************************************************

名称：void ov2640_light_mode_config(u8 mode)
功能：ov2640 亮度模式选择
输入参数：亮度模式常量
输出参数：无
返回值：  无
**************************************************/
void ov2640_light_mode_config(u8 mode)
{
  u8 data;

  switch(mode)
  {
    case AUTO:
      data = 0x00;
      iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

	  data = 0x00;
      iic_rw(&data, 1, 0xc7, OV2640_ADDR, WRITE);
	  break;
	case SUNNY:
	  data = 0x00;
      iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

	  data = 0x40;
      iic_rw(&data, 1, 0xc7, OV2640_ADDR, WRITE);
	  
	  data = 0x5e;
      iic_rw(&data, 1, 0xcc, OV2640_ADDR, WRITE);

	  data = 0x41;
      iic_rw(&data, 1, 0xcd, OV2640_ADDR, WRITE);

	  data = 0x54;
      iic_rw(&data, 1, 0xce, OV2640_ADDR, WRITE);
      break;
   case CLOUDY:
	  data = 0x00;
      iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

	  data = 0x40;
      iic_rw(&data, 1, 0xc7, OV2640_ADDR, WRITE);
	  
	  data = 0x65;
      iic_rw(&data, 1, 0xcc, OV2640_ADDR, WRITE);

	  data = 0x41;
      iic_rw(&data, 1, 0xcd, OV2640_ADDR, WRITE);

	  data = 0x4f;
      iic_rw(&data, 1, 0xce, OV2640_ADDR, WRITE);
	  break;
   case OFFICE:
	 data = 0x00;
      iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

	  data = 0x40;
      iic_rw(&data, 1, 0xc7, OV2640_ADDR, WRITE);
	  
	  data = 0x52;
      iic_rw(&data, 1, 0xcc, OV2640_ADDR, WRITE);

	  data = 0x41;
      iic_rw(&data, 1, 0xcd, OV2640_ADDR, WRITE);

	  data = 0x66;
      iic_rw(&data, 1, 0xce, OV2640_ADDR, WRITE);
	  break;
  case HOME:
	  data = 0x00;
      iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

	  data = 0x40;
      iic_rw(&data, 1, 0xc7, OV2640_ADDR, WRITE);
	  
	  data = 0x42;
      iic_rw(&data, 1, 0xcc, OV2640_ADDR, WRITE);

	  data = 0x3f;
      iic_rw(&data, 1, 0xcd, OV2640_ADDR, WRITE);

	  data = 0x71;
      iic_rw(&data, 1, 0xce, OV2640_ADDR, WRITE);		
	  break;
  default:
	  data = 0x00;
      iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

	  data = 0x00;
      iic_rw(&data, 1, 0xc7, OV2640_ADDR, WRITE);
	  break;
	}
}
/*************************************************

名称：void ov2640_black_white_config(u8 blackwhite)
功能：ov2640 彩色黑白模式设置
输入参数：
        0x18 for B&W,
        0x40 for Negative,
        0x58 for B&W negative,
        0x00 for Normal,
输出参数：无
返回值：  无
**************************************************/
void ov2640_black_white_config(u8 blackwhite)
{
  u8 data;

  data = 0x00;
  iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

  data = 0x00;
  iic_rw(&data, 1, 0x7c, OV2640_ADDR, WRITE);

  data =blackwhite;
  iic_rw(&data, 1, 0x7d, OV2640_ADDR, WRITE);

  data = 0x05;
  iic_rw(&data, 1, 0x7c, OV2640_ADDR, WRITE);

  data = 0x80;
  iic_rw(&data, 1, 0x7d, OV2640_ADDR, WRITE);

  data = 0x80;
  iic_rw(&data, 1, 0x7d, OV2640_ADDR, WRITE);
}
/*************************************************

名称：void ov2640_color_saturation(u8 value1, u8 value2)
功能：ov2640 色饱和度设置
输入参数：
        value1 = 0x68, value2 = 0x68 for +2,
		value1 = 0x58, value2 = 0x58 for +1,
		value1 = 0x48, value2 = 0x48 for 0,
		value1 = 0x38, value2 = 0x38 fOR -1,
		value1 = 0x28, value2 = 0x28 for -2,     
输出参数：无
返回值：  无
**************************************************/
void ov2640_color_saturation(u8 value1, u8 value2)
{
  u8 data;

  data =0x00;
  iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

  data = 0x00;
  iic_rw(&data, 1, 0x7c, OV2640_ADDR, WRITE);

  data = 0x02;
  iic_rw(&data, 1, 0x7d, OV2640_ADDR, WRITE);

  data =0x03;
  iic_rw(&data, 1, 0x7c, OV2640_ADDR, WRITE);

  data = value1;
  iic_rw(&data, 1, 0x7d, OV2640_ADDR, WRITE);

  data = value2;
  iic_rw(&data, 1, 0x7d, OV2640_ADDR, WRITE);
}
/*************************************************

名称：void ov2640_color_effectsConfig(u8 value1, u8 value2)
功能：ov2640色彩显示模式设置
输入参数：
        value1 = 0x40, value2 = 0xa6 for Antique,
        value1 = 0xa0, value2 = 0x40 for Bluish,
        value1 = 0x40, value2 = 0x40 for Greenish,
        value1 = 0x40, value2 = 0xc0 for Reddish,
输出参数：无
返回值：  无
**************************************************/
void ov2640_color_effectsConfig(u8 value1, u8 value2)
{
  u8 data;

  data = 0x00;
  iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

  data = 0x00;
  iic_rw(&data, 1, 0x7c, OV2640_ADDR, WRITE);

  data = 0x18;
  iic_rw(&data, 1, 0x7d, OV2640_ADDR, WRITE);

  data = 0x05;
  iic_rw(&data, 1, 0x7c, OV2640_ADDR, WRITE);

  data = value1;
  iic_rw(&data, 1, 0x7d, OV2640_ADDR, WRITE);

  data = value2;
  iic_rw(&data, 1, 0x7d, OV2640_ADDR, WRITE);
}
/*************************************************

名称：void ov2640_contrast_config(u8 value1, u8 value2)
功能：ov2640对比度设置
输入参数：
        value1 = 0x28, value2 = 0x0c for Contrast +2,
        value1 = 0x24, value2 = 0x16 for Contrast +1,
        value1 = 0x20, value2 = 0x20 for Contrast 0,
        value1 = 0x1c, value2 = 0x2a for Contrast -1,
        value1 = 0x18, value2 = 0x34 for Contrast -2,
输出参数：无
返回值：  无
**************************************************/
void ov2640_contrast_config(u8 value1, u8 value2)
{
  u8 data;

  data = 0x00;
  iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

  data = 0x00;
  iic_rw(&data, 1, 0x7c, OV2640_ADDR, WRITE);

  data = 0x04;
  iic_rw(&data, 1, 0x7d, OV2640_ADDR, WRITE);

  data = 0x07;
  iic_rw(&data, 1, 0x7c, OV2640_ADDR, WRITE);

  data = 0x20;
  iic_rw(&data, 1, 0x7d, OV2640_ADDR, WRITE);

  data = value1;
  iic_rw(&data, 1, 0x7d, OV2640_ADDR, WRITE);

  data = value2;
  iic_rw(&data, 1, 0x7d, OV2640_ADDR, WRITE);

  data = 0x06;
  iic_rw(&data, 1, 0x7d, OV2640_ADDR, WRITE);
}
/*************************************************

名称：ov2640_brightness_config(u8 brightness)
功能：ov2640亮度设置
输入参数：
        0x40 for Brightness +2,
        0x30 for Brightness +1,
        0x20 for Brightness 0,
        0x10 for Brightness -1,
        0x00 for Brightness -2,
输出参数：无
返回值：  无
**************************************************/
void ov2640_brightness_config(u8 brightness)
{ 
  u8 data;

  data = 0x00;
  iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

  data = 0x00;
  iic_rw(&data, 1, 0x7c, OV2640_ADDR, WRITE);

  data = 0x04;
  iic_rw(&data, 1, 0x7d, OV2640_ADDR, WRITE);

  data = 0x09;
  iic_rw(&data, 1, 0x7c, OV2640_ADDR, WRITE);

  data = brightness;
  iic_rw(&data, 1, 0x7d, OV2640_ADDR, WRITE);

  data = 0x00;
  iic_rw(&data, 1, 0x7d, OV2640_ADDR, WRITE);
}
/*************************************************

名称：void ov2640_auto_exposure(u8 level)
功能：ov2640自动曝光等级设置
输入参数：0 - 4
输出参数：无
返回值：  无
**************************************************/
void ov2640_auto_exposure(u8 level)
{
  u8 data;
  switch(level)
  {
    case 0:
      data = 0x01;
      iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

	  data = 0x20;
      iic_rw(&data, 1, 0x24, OV2640_ADDR, WRITE);
	  
	  data = 0x18;
      iic_rw(&data, 1, 0x25, OV2640_ADDR, WRITE);

	  data = 0x60;
      iic_rw(&data, 1, 0x26, OV2640_ADDR, WRITE);
	  break;
	case 1:
	  data = 0x01;
      iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

	  data = 0x34;
      iic_rw(&data, 1, 0x24, OV2640_ADDR, WRITE);
	  
	  data = 0x1c;
      iic_rw(&data, 1, 0x25, OV2640_ADDR, WRITE);

	  data = 0x70;
      iic_rw(&data, 1, 0x26, OV2640_ADDR, WRITE);
      break;
    case 2:
	  data = 0x01;
      iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

	  data = 0x3e;
      iic_rw(&data, 1, 0x24, OV2640_ADDR, WRITE);
	  
      data = 0x38;
      iic_rw(&data, 1, 0x25, OV2640_ADDR, WRITE);

	  data = 0x81;
      iic_rw(&data, 1, 0x26, OV2640_ADDR, WRITE);
	  break;
    case 3:
      data = 0x01;
      iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

	  data = 0x48;
      iic_rw(&data, 1, 0x24, OV2640_ADDR, WRITE);
	  
	  data = 0x40;
      iic_rw(&data, 1, 0x25, OV2640_ADDR, WRITE);

	  data = 0x81;
      iic_rw(&data, 1, 0x26, OV2640_ADDR, WRITE);
	  break;
    case 4:
	  data = 0x01;
      iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

	  data = 0x58;
      iic_rw(&data, 1, 0x24, OV2640_ADDR, WRITE);
	  
	  data = 0x50;
      iic_rw(&data, 1, 0x25, OV2640_ADDR, WRITE);

	  data = 0x92;
      iic_rw(&data, 1, 0x26, OV2640_ADDR, WRITE);		
	  break;
    default:
	  data = 0x01;
      iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

	  data = 0x20;
      iic_rw(&data, 1, 0x24, OV2640_ADDR, WRITE);
	  
	  data = 0x18;
      iic_rw(&data, 1, 0x25, OV2640_ADDR, WRITE);

	  data = 0x60;
      iic_rw(&data, 1, 0x26, OV2640_ADDR, WRITE);
	  break;
	}
}
/*************************************************

名称：void ov2640_delay(u32 count)
功能：延时
输入参数：延时参数
输出参数：无
返回值：无
**************************************************/
void ov2640_delay(u32 count)
{
  for(; count != 0; count--);
}
/*************************************************

名称：void ov2640_reset(void)
功能：ov2640复位
输入参数：无
输出参数：无
返回值：  无
**************************************************/
void ov2640_reset(void)
{
  u8 data;

  data = 0x01;
  iic_rw(&data, 1, OV2640_DSP_RA_DLMT, OV2640_ADDR, WRITE);

  data = 0x80;
  iic_rw(&data, 1, OV2640_SENSOR_COM7, OV2640_ADDR, WRITE);
}

/*************************************************

名称：void ov2640_jpeg_config(image_format_typedef image_format)
功能：ov2640对应分辨率下JPEG输出模式设置
输入参数：
        JPEG_176x144 =  0x00,	    
        JPEG_320x240 =  0x01,	    
        JPEG_352x288 =  0x02,	    
        JPEG_640x480 =  0x03,	   
        JPEG_800x600 =  0x04,	   
        JPEG_1024x768 = 0x05,	    
输出参数：无
返回值：  无
**************************************************/
void ov2640_jpeg_config(image_format_typedef image_format)
{
  u8 data;
  u32 i;

  ov2640_reset();
  ov2640_delay(0x500000);

  /* initialize ov2640 */
  for(i = 0; i < (sizeof(ov2640_jpeg_init) / 2); i++)
  {
    data = ov2640_jpeg_init[i][1];
	iic_rw(&data, 1, ov2640_jpeg_init[i][0], OV2640_ADDR, WRITE);
	ov2640_delay(0x1000);
  }

  /* set to output YUV422 */
  for(i = 0; i < (sizeof(ov2640_yuv422) / 2); i++)
  {
    data = ov2640_yuv422[i][1];
	iic_rw(&data, 1, ov2640_yuv422[i][0], OV2640_ADDR, WRITE);
	ov2640_delay(0x1000);
  }

  data = 0x01;
  iic_rw(&data, 1, 0xff, OV2640_ADDR, WRITE);

  data = 0x00;
  iic_rw(&data, 1, 0x15, OV2640_ADDR, WRITE);

  /* set to output jpeg */
  for(i = 0; i < (sizeof(ov2640_jpeg) / 2); i++)
  {
    data = ov2640_jpeg[i][1];
    iic_rw(&data, 1, ov2640_jpeg[i][0], OV2640_ADDR, WRITE);
	ov2640_delay(0x1000);
  }

  ov2640_delay(0x500000);

  switch(image_format)
  {
	case JPEG_176x144:
      for(i = 0; i < (sizeof(ov2640_176x144_jpeg) / 2); i++)
      {
	    data = ov2640_176x144_jpeg[i][1];
        iic_rw(&data, 1, ov2640_176x144_jpeg[i][0], OV2640_ADDR, WRITE);
      } 
      break;
	case JPEG_320x240:
      for(i = 0; i < (sizeof(ov2640_320x240_jpeg) / 2); i++)
      {
	    data = ov2640_320x240_jpeg[i][1];
        iic_rw(&data, 1, ov2640_320x240_jpeg[i][0], OV2640_ADDR, WRITE);
		ov2640_delay(0x1000);
      }
      break;
	case JPEG_352x288:
      for(i = 0; i < (sizeof(ov2640_352x288_jpeg) / 2); i++)
      {
	    data = ov2640_352x288_jpeg[i][1];
        iic_rw(&data, 1, ov2640_352x288_jpeg[i][0], OV2640_ADDR, WRITE);
		ov2640_delay(0x1000);
      }
      break;
	case JPEG_640x480:
      for(i  =0; i < (sizeof(ov2640_640x480_jpeg) / 2); i++)
      {
	    data = ov2640_640x480_jpeg[i][1];
        iic_rw(&data, 1, ov2640_640x480_jpeg[i][0], OV2640_ADDR, WRITE);
		ov2640_delay(0x1000);
      }
      break;
	case JPEG_800x600:
      for(i = 0; i < (sizeof(ov2640_800x600_jpeg) / 2); i++)
      {
	    data = ov2640_800x600_jpeg[i][1];
        iic_rw(&data, 1, ov2640_800x600_jpeg[i][0], OV2640_ADDR, WRITE);
		ov2640_delay(0x1000);
      }
      break;
    case JPEG_1024x768:
      for(i = 0; i < (sizeof(ov2640_1024x768_jpeg) / 2); i++)
      {
	    data = ov2640_1024x768_jpeg[i][1];
        iic_rw(&data, 1, ov2640_1024x768_jpeg[i][0], OV2640_ADDR, WRITE);
		ov2640_delay(0x1000);
      }
      break;
    default:
      for(i = 0; i < (sizeof(ov2640_320x240_jpeg) / 2); i++)
      {
	    data=ov2640_320x240_jpeg[i][1];
        iic_rw(&data, 1, ov2640_320x240_jpeg[i][0], OV2640_ADDR, WRITE);
		ov2640_delay(0x1000);
      }
      break;
  }
}
void ov2640_interrupt_enable(void)
{
  /* 使能像素同步中断 */
   EXTI->IMR |= EXTI_Line0;				
   EXTI->EMR |= EXTI_Line0;
}
void ov2640_interrupt_disable(void)
{
  /* 关闭像素同步中断 */
   EXTI->IMR &= ~EXTI_Line0;				
   EXTI->EMR &= ~EXTI_Line0; 
}
/***************************************************************************************************/
